<!DOCTYPE html>

<html lang="en">
<%- include('head'); %>

<body>
    
    <%- include('header'); %>
    
    <br>
    
    <form id="queryForm">
        <label>
            <input type="radio" name="queryType" value="write" id="writeQuery" checked> Write query
        </label>
        <label>
            <input type="radio" name="queryType" value="upload" id="uploadQuery"> Upload SQL file
        </label>
        
        <div id="writeQueryDiv">
            <textarea name="queryText" id="queryText" rows="4" cols="50" 
            placeholder="Enter your SQL query here">select * from dual</textarea>
        </div>
        
        <div id="uploadQueryDiv">
            <label for="SQLfile">Upload SQL file:</label>
            <input type="file" name="SQLfile" id="SQLfile" accept=".sql">
        </div>
        
        <input type="submit" value="Submit">
    </form>
    
    <br>
    
    <canvas width="500" height="500">
        
        <style>
            canvas {
                border: 1px solid rgb(0, 0, 0);
            }
        </style>
        
        <script src="/res/js/sqlite-parser.js"></script>
        <script>
            
            // Get references to form elements
            const queryForm = document.getElementById("queryForm");
            const writeQueryDiv = document.getElementById("writeQueryDiv");
            const uploadQueryDiv = document.getElementById("uploadQueryDiv");
            
            // Event listener for radio button change
            queryForm.addEventListener("change", function () {
                const selectedQueryType = document.querySelector('input[name="queryType"]:checked').value;
                if (selectedQueryType === "write") {
                    writeQueryDiv.style.display = "block";
                    uploadQueryDiv.style.display = "none";
                } else if (selectedQueryType === "upload") {
                    writeQueryDiv.style.display = "none";
                    uploadQueryDiv.style.display = "block";
                }
            });
            
            
            document.querySelector("form").addEventListener("submit", (event) => {
                event.preventDefault();

                const formData = new FormData(event.target);

                console.log(formData.get("queryText"), 123, formData.get("queryFile"))

                // Check which query type is selected
                const selectedQueryType = document.querySelector('input[name="queryType"]:checked').value;
                
                if (selectedQueryType === "write") {
                    // If "Write query" is selected, get the query from the textarea
                    const query = document.querySelector("#queryText").value;
                    logQuery(query);
                } else if (selectedQueryType === "upload") {
                    // If "Upload SQL file" is selected, handle the file upload
                    // You can add code here to handle the file upload if needed
                }
            });

            function logQuery(query) {
                var sqliteParser = window.sqliteParser;
                var ast = sqliteParser(query);
                console.log("Parsed SQL:");
                console.log(JSON.stringify(ast, null, 2));
            }

        </script>
        
        <%- include('footer'); %>
        
    </body>
    
    </html>